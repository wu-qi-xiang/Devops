### istio基础

#### 原理

istio是一个服务网格，通过非入侵式的微服务治理解决方案，解决云原生服务的管理和网络治理问题

通过非入侵式的服务，通过dynamic admission，在业务pod中新增一个envoy的sidecar镜像，因为是相同的network空间，通过iptables去实现流量治理。

#### 产品功能

**灰度发布：**

* 基于请求内容的灰度发布规则，可以配置header，cookie等多种信息
* 基于流量比例的灰度发布规则，根据权重比例分配流量

**流量治理：**

* 连接池管理：支持设置最大连接数，最大重试次数，连接超时时间
* 熔断：支持配置服务熔断规则，配置多次失败之后，在一段时间内不分配流量。
* 重试：支持配置http重试次数，重试超时时间
* 超时：支持配置http请求超时时间
* 负载均衡：支持配置随机调度，轮询调度
* 故障注入：支持配置中断故障，一般测试服务需要

**安全：**

* 对端认证：支持配置访问认证
* 访问授权：支持配置服务之间的访问控制功能

**可观察性：**

* 调用链：支持非入侵式埋点
* 访问拓扑图：支持网格应用的访问拓扑图

灰度发布：

destination rule配置2个不同的版本，virtual service配置流量的访问权重

ingress  gateway  + virtual service  流量流入

engress  gateway + destination rule  + service entry流量流出

# TCP基础知识

## 网络协议分层模型

### OSI七层模型
- 物理层
- 数据链路层
- 网络层
- 传输层
- 会话层
- 表示层
- 应用层

### TCP/IP四层模型
- 网络接口层
- 国际互联层
- 传输层
- 应用层

## TCP连接特性

### TCP连接类型

#### 长连接
- 在发包完毕后，会在一定时间内保持连接
- 使用 `Keepalive`（存活定时器）功能维持连接

#### 短连接
- 数据包发送完成后就会自动断开连接

> **注意**：HTTP1.1及以上版本默认使用长连接，一次连接可多次复用传输，具有存活检测（keep-alive）功能。

### TCP连接建立与断开

#### 三次握手
主要作用：确认双方的接收和发送能力是否正常，指定初始化序列号（`Init Sequence Number, ISN`）为后续可靠传输做准备。

1. **第一次握手**（客户端 → 服务器）
   - 客户端发送 `SYN` 报文
   - 服务器确认：对方发送正常，自己接收正常
   - 客户端此时不能确认任何信息

2. **第二次握手**（服务器 → 客户端）
   - 服务器响应 `SYN` 报文
   - 客户端确认：自己发送、接收正常，对方发送、接收正常
   - 服务器确认：对方发送正常，自己接收正常

3. **第三次握手**（客户端 → 服务器）
   - 客户端发送 `ACK` 报文
   - 双方都确认：自己和对方的发送、接收能力均正常

#### 四次挥手
主要作用：安全地关闭双方的发送和接收连接。

1. **第一次挥手**（客户端 → 服务器）
   - 客户端发送 `FIN` 报文（`FIN = 1`）
   - 客户端进入 `FIN_WAIT1` 状态

2. **第二次挥手**（服务器 → 客户端）
   - 服务器发送 `ACK` 报文
   - 服务器进入 `CLOSE_WAIT` 状态

3. **第三次挥手**（服务器 → 客户端）
   - 服务器发送 `FIN` 报文
   - 服务器进入 `LAST_ACK` 状态

4. **第四次挥手**（客户端 → 服务器）
   - 客户端发送 `ACK` 报文
   - 客户端进入 `TIME_WAIT` 状态